# üêõ –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –ü–†–û–ë–õ–ï–ú–ò –ó –ö–ê–õ–ï–ù–î–ê–†–ï–ú

## üìã –©–æ –±—É–ª–æ –Ω–µ —Ç–∞–∫?

### **–ü—Ä–æ–±–ª–µ–º–∞ 1: –î–∞—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞–ª–∏—Å—å —è–∫ —Ä—è–¥–∫–∏**
MongoDB –∑–±–µ—Ä—ñ–≥–∞–≤ `start_date` —Ç–∞ `end_date` —è–∫ **—Å—Ç—Ä–æ–∫–∏**, –∞ –Ω–µ —è–∫ **Date –æ–±'—î–∫—Ç–∏**.

**–ù–∞—Å–ª—ñ–¥–∫–∏:**
- ‚ùå –§—ñ–ª—å—Ç—Ä–∏ –∑–∞ –¥–∞—Ç–∞–º–∏ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞–ª–∏
- ‚ùå –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –¥–∞—Ç –ø—Ä–∞—Ü—é–≤–∞–ª–æ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–æ
- ‚ùå –ü–æ–¥—ñ—ó –Ω–µ –ø–æ–∫–∞–∑—É–≤–∞–ª–∏—Å—å —É –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –º—ñ—Å—è—Ü—ñ

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- ‚úÖ Backend —Ç–µ–ø–µ—Ä –∫–æ–Ω–≤–µ—Ä—Ç—É—î —Å—Ç—Ä–æ–∫–∏ –≤ Date (`new Date(start_date)`)
- ‚úÖ –ü—Ä–∏ POST —Ç–∞ PUT –∑–∞–ø–∏—Ç–∞—Ö

---

### **–ü—Ä–æ–±–ª–µ–º–∞ 2: –§—ñ–ª—å—Ç—Ä –∑–∞ –º—ñ—Å—è—Ü–µ–º –±—É–≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π**
API —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞–≤ –ø–æ–¥—ñ—ó —Ç–∞–∫:
```javascript
// –°—Ç–∞—Ä–∏–π –∫–æ–¥ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
query.start_date = {
  $gte: startOfMonth,
  $lte: endOfMonth
}
// –ü–æ–∫–∞–∑—É–≤–∞–ª–∞—Å—å –ø–æ–¥—ñ—è –¢–Ü–õ–¨–ö–ò —è–∫—â–æ start_date –≤ –º–µ–∂–∞—Ö –º—ñ—Å—è—Ü—è
```

**–ù–∞—Å–ª—ñ–¥–∫–∏:**
- ‚ùå –ü–æ–¥—ñ—è 30 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ ‚Üí 5 –≥—Ä—É–¥–Ω—è –ù–ï –ø–æ–∫–∞–∑—É–≤–∞–ª–∞—Å—å –≤ –≥—Ä—É–¥–Ω—ñ
- ‚ùå –í—Ç—Ä–∞—á–∞–ª–∏—Å—å –±–∞–≥–∞—Ç–æ–¥–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```javascript
// –ù–æ–≤–∏–π –∫–æ–¥ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
query.$and = [
  { start_date: { $lte: endOfMonth } },
  { end_date: { $gte: startOfMonth } }
]
// –ü–æ–¥—ñ—è –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è —è–∫—â–æ –ü–ï–†–ï–¢–ò–ù–ê–Ñ–¢–¨–°–Ø –∑ –º—ñ—Å—è—Ü–µ–º
```

---

### **–ü—Ä–æ–±–ª–µ–º–∞ 3: –ü–æ–¥—ñ—ó –Ω–µ –ø–æ–∫–∞–∑—É–≤–∞–ª–∏—Å—å –Ω–∞ –≤—Å—ñ—Ö –¥–Ω—è—Ö**
Frontend –ø–æ–∫–∞–∑—É–≤–∞–≤ –ø–æ–¥—ñ—é –¢–Ü–õ–¨–ö–ò –≤ –¥–µ–Ω—å –ø–æ—á–∞—Ç–∫—É:

```javascript
// –°—Ç–∞—Ä–∏–π –∫–æ–¥:
const eventDate = new Date(event.start_date);
return eventDate.getDate() === date.getDate();
// –ü–æ–¥—ñ—è 13-15 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ –ø–æ–∫–∞–∑—É–≤–∞–ª–∞—Å—å –¢–Ü–õ–¨–ö–ò 13–≥–æ
```

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```javascript
// –ù–æ–≤–∏–π –∫–æ–¥:
const eventStart = new Date(event.start_date);
const eventEnd = new Date(event.end_date);
return eventStart <= dayEnd && eventEnd >= dayStart;
// –ü–æ–¥—ñ—è 13-15 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è 13, 14, 15–≥–æ
```

---

## üîß –Ø–ö –í–ò–ü–†–ê–í–ò–¢–ò

### **–ö—Ä–æ–∫ 1: –û–Ω–æ–≤—ñ—Ç—å –∫–æ–¥** ‚úÖ
–ö–æ–¥ –≤–∂–µ –æ–Ω–æ–≤–ª–µ–Ω–æ! –§–∞–π–ª–∏:
- `pages/api/admin/calendar.ts` - backend
- `pages/admin/calendar.tsx` - frontend

### **–ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä**
```bash
# –ó—É–ø–∏–Ω—ñ—Ç—å –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
# –ó–∞–ø—É—Å—Ç—ñ—Ç—å –∑–Ω–æ–≤—É:
npm run dev
```

### **–ö—Ä–æ–∫ 3: –ú—ñ–≥—Ä—É–π—Ç–µ —Å—Ç–∞—Ä—ñ –¥–∞–Ω—ñ (—è–∫—â–æ —î –ø–æ–¥—ñ—ó –≤ –±–∞–∑—ñ)**

–Ø–∫—â–æ –≤–∏ **–≤–∂–µ —Å—Ç–≤–æ—Ä–∏–ª–∏ –ø–æ–¥—ñ—ó** –¥–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è, –≤–æ–Ω–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —è–∫ —Ä—è–¥–∫–∏. –á—Ö —Ç—Ä–µ–±–∞ –º—ñ–≥—Ä—É–≤–∞—Ç–∏:

```bash
cd /Users/yurii/KovchegFrontend

# –ó–∞–ø—É—Å—Ç—ñ—Ç—å –º—ñ–≥—Ä–∞—Ü—ñ—é:
node scripts/migrate-calendar-dates.js
```

**–©–æ —Ä–æ–±–∏—Ç—å –º—ñ–≥—Ä–∞—Ü—ñ—è:**
- ‚úÖ –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å—ñ –ø–æ–¥—ñ—ó
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ –¥–∞—Ç–∏ —î —Ä—è–¥–∫–∞–º–∏
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç—É—î –≤ Date –æ–±'—î–∫—Ç–∏
- ‚úÖ –û–Ω–æ–≤–ª—é—î –≤ –±–∞–∑—ñ

**–ë–µ–∑–ø–µ–∫–∞:**
- üü¢ –ù–µ –≤–∏–¥–∞–ª—è—î –¥–∞–Ω—ñ
- üü¢ –ù–µ –∑–º—ñ–Ω—é—î –ø–æ–¥—ñ—ó –¥–µ –¥–∞—Ç–∏ –≤–∂–µ Date
- üü¢ –ú–æ–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤

---

## üß™ –Ø–ö –ü–ï–†–ï–í–Ü–†–ò–¢–ò –©–û –ü–†–ê–¶–Æ–Ñ

### **–¢–µ—Å—Ç 1: –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É –ø–æ–¥—ñ—é**
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –∫–∞–ª–µ–Ω–¥–∞—Ä
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –ø–æ–¥—ñ—é: **13 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 10:00 ‚Üí 15 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 18:00**
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:
   - ‚úÖ –ü–æ–¥—ñ—è –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è 13, 14, 15 –ª–∏—Å—Ç–æ–ø–∞–¥–∞
   - ‚úÖ –ü—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø–æ–¥—ñ—è –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è

### **–¢–µ—Å—Ç 2: –ü–æ–¥—ñ—è –Ω–∞ –º–µ–∂—ñ –º—ñ—Å—è—Ü—ñ–≤**
1. –°—Ç–≤–æ—Ä—ñ—Ç—å –ø–æ–¥—ñ—é: **30 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 10:00 ‚Üí 2 –≥—Ä—É–¥–Ω—è 18:00**
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–∏—Å—Ç–æ–ø–∞–¥:
   - ‚úÖ –ü–æ–¥—ñ—è –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è 30 –ª–∏—Å—Ç–æ–ø–∞–¥–∞
3. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ –≥—Ä—É–¥–µ–Ω—å:
   - ‚úÖ –ü–æ–¥—ñ—è –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è 1, 2 –≥—Ä—É–¥–Ω—è

### **–¢–µ—Å—Ç 3: –§—ñ–ª—å—Ç—Ä –¥–ª—è –≤–ª–∞—Å–Ω–∏–∫–∞ vs —Ä—ñ—î–ª—Ç–æ—Ä–∞**
1. –£–≤—ñ–π–¥—ñ—Ç—å —è–∫ **–≤–ª–∞—Å–Ω–∏–∫**:
   - ‚úÖ –ë–∞—á–∏—Ç–µ –≤—Å—ñ –ø–æ–¥—ñ—ó –≤—ñ–¥ –≤—Å—ñ—Ö —Ä—ñ—î–ª—Ç–æ—Ä—ñ–≤
2. –£–≤—ñ–π–¥—ñ—Ç—å —è–∫ **—Ä—ñ—î–ª—Ç–æ—Ä**:
   - ‚úÖ –ë–∞—á–∏—Ç–µ —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –ø–æ–¥—ñ—ó

---

## üìä –¢–ï–•–ù–Ü–ß–ù–Ü –î–ï–¢–ê–õ–Ü

### **–ó–º—ñ–Ω–∏ –≤ API (calendar.ts):**

**GET –∑–∞–ø–∏—Ç:**
```typescript
// –ë—É–ª–æ:
query.start_date = { $gte: startOfMonth, $lte: endOfMonth };

// –°—Ç–∞–ª–æ:
query.$and = [
  { start_date: { $lte: periodEnd } },
  { end_date: { $gte: periodStart } }
];
```

**POST –∑–∞–ø–∏—Ç:**
```typescript
// –ë—É–ª–æ:
const eventData = { ...req.body };

// –°—Ç–∞–ª–æ:
const eventData = {
  ...rest,
  start_date: new Date(start_date),
  end_date: new Date(end_date),
};
```

**PUT –∑–∞–ø–∏—Ç:**
```typescript
// –ë—É–ª–æ:
$set: { ...updateData }

// –°—Ç–∞–ª–æ:
if (start_date) updateData.start_date = new Date(start_date);
if (end_date) updateData.end_date = new Date(end_date);
$set: updateData
```

### **–ó–º—ñ–Ω–∏ —É frontend (calendar.tsx):**

**getEventsForDay:**
```typescript
// –ë—É–ª–æ:
const eventDate = new Date(event.start_date);
return eventDate.getDate() === date.getDate();

// –°—Ç–∞–ª–æ:
const eventStart = new Date(event.start_date);
const eventEnd = new Date(event.end_date);
return eventStart <= dayEnd && eventEnd >= dayStart;
```

**–í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ñ–æ—Ä–º–∏:**
```tsx
<input
  type="datetime-local"
  value={formData.end_date}
  min={formData.start_date} // ‚Üê –î–æ–¥–∞–Ω–æ!
/>
```

---

## üéØ –û–ß–Ü–ö–£–í–ê–ù–Ü –†–ï–ó–£–õ–¨–¢–ê–¢–ò

### **–î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** ‚ùå
- –ü–æ–¥—ñ—è —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–ª–µ –Ω–µ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è
- –ê–±–æ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω –¥–µ–Ω—å
- –ü—ñ—Å–ª—è –∑–º—ñ–Ω–∏ –º—ñ—Å—è—Ü—è –ø–æ–¥—ñ—è –∑–Ω–∏–∫–∞—î

### **–ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** ‚úÖ
- –ü–æ–¥—ñ—è –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –≤—Å—ñ—Ö –¥–Ω—è—Ö (–ø–æ—á–∞—Ç–æ–∫ ‚Üí –∫—ñ–Ω–µ—Ü—å)
- –ü–æ–¥—ñ—è –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
- –ë–∞–≥–∞—Ç–æ–¥–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –í–ª–∞—Å–Ω–∏–∫ –±–∞—á–∏—Ç—å –≤—Å—ñ –ø–æ–¥—ñ—ó
- –†—ñ—î–ª—Ç–æ—Ä –±–∞—á–∏—Ç—å —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó

---

## üÜò –Ø–ö–©–û –©–ï –ù–ï –ü–†–ê–¶–Æ–Ñ

### **1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –∑–∞–ø—É—â–µ–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è:**
```bash
node scripts/migrate-calendar-dates.js
```

### **2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞—Ç–∏ –≤ –±–∞–∑—ñ:**
```bash
# –í—ñ–¥–∫—Ä–∏–π—Ç–µ MongoDB Atlas
# Collections ‚Üí calendar_events
# –ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –Ω–∞ start_date —Ç–∞ end_date
# –ú–∞—é—Ç—å –±—É—Ç–∏ Date –æ–±'—î–∫—Ç–∏, –ù–ï —Å—Ç—Ä–æ–∫–∏
```

### **3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ console –≤ –±—Ä–∞—É–∑–µ—Ä—ñ:**
```
F12 ‚Üí Console ‚Üí —à—É–∫–∞–π—Ç–µ –ø–æ–º–∏–ª–∫–∏
```

### **4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Network –∑–∞–ø–∏—Ç–∏:**
```
F12 ‚Üí Network ‚Üí /api/admin/calendar
–ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å - —á–∏ —î –ø–æ–¥—ñ—ó –≤ data[]
```

### **5. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π admin.id:**
```javascript
// –í console –±—Ä–∞—É–∑–µ—Ä–∞:
JSON.parse(localStorage.getItem('admin_info'))
// –ú–∞—î –±—É—Ç–∏: { id: "...", role: "owner"/"agent", ... }
```

---

## üìù –î–û–î–ê–¢–ö–û–í–û

### **–Ø–∫—â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –ø–æ–¥—ñ—ó —ñ –ø–æ—á–∞—Ç–∏ –∑–Ω–æ–≤—É:**

‚ö†Ô∏è **–£–í–ê–ì–ê: –¶–µ –≤–∏–¥–∞–ª–∏—Ç—å –í–°–Ü –ø–æ–¥—ñ—ó –∑ –±–∞–∑–∏!**

```bash
node -e "
const { MongoClient } = require('mongodb');
require('dotenv').config({ path: '.env.local' });

async function clear() {
  const client = new MongoClient(process.env.MONGODB_URI);
  await client.connect();
  const db = client.db('kovcheg_db');
  const result = await db.collection('calendar_events').deleteMany({});
  console.log(\`‚úÖ –í–∏–¥–∞–ª–µ–Ω–æ \${result.deletedCount} –ø–æ–¥—ñ–π\`);
  await client.close();
}

clear();
"
```

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ:** 13 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û  
**–í–µ—Ä—Å—ñ—è:** 1.0

